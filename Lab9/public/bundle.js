(()=>{"use strict";var e,t={487:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.selectShape=function(e){this.m_model.selectShape(e)},e}();t.CanvasController=n},588:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionController=void 0;var n=function(){function e(e){this.m_canvas=e}return e.prototype.resizeShape=function(e,t,n,o){var i=this.m_canvas.getSelectedShapeId();if(null!==i){var r=this.m_canvas.getShapeById(i);if(r){var a=r.getFrame();e=Math.min(Math.max(e,0),a.left+a.width),t=Math.min(Math.max(t,0),a.top+a.height),n=Math.min(Math.max(n,a.left),this.m_canvas.getWidth()),o=Math.min(Math.max(o,a.top),this.m_canvas.getHeight()),r.setFrame({left:e,top:t,width:n-e,height:o-t})}}},e}();t.SelectionController=n},623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeController=void 0;var n=function(){function e(e){this.m_shapeModel=e}return e.prototype.moveShape=function(e,t){var n=this.m_shapeModel.getCanvas(),o=this.m_shapeModel.getFrame();e=Math.min(Math.max(e,0),n.getWidth()-o.width),t=Math.min(Math.max(t,0),n.getHeight()-o.height),this.m_shapeModel.setFrame({left:e,top:t,width:o.width,height:o.height})},e}();t.ShapeController=n},837:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarController=void 0;var n=function(){function e(e){this.m_model=e}return e.prototype.addShape=function(e){this.m_model.addShape(e)},e.prototype.removeShape=function(e){this.m_model.removeShape(e)},e.prototype.selectShape=function(e){this.m_model.selectShape(e)},e}();t.ToolbarController=n},59:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Event=t.IEvent=void 0;t.IEvent=function(){};var n=function(){function e(){this.m_listeners=[]}return e.prototype.add=function(e){var t=this;return this.m_listeners.push(e),function(){var n=t.m_listeners.indexOf(e);n>=0&&t.m_listeners.splice(n,1)}},e.prototype.addCallOnce=function(e){var t=this.add((function(n){e(n),t()}))},e.prototype.dispatch=function(e){for(var t=0,n=this.m_listeners;t<n.length;t++)(0,n[t])(e)},e}();t.Event=n},658:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;var o=n(59),i=function(){function e(e,t){this.m_shapes=new Map,this.onSelectedShapeChanged=new o.Event,this.onShapeAdded=new o.Event,this.onShapeRemoved=new o.Event,this.m_width=e,this.m_height=t,this.m_selectedShapeId=null}return e.prototype.getOnShapeAdded=function(){return this.onShapeAdded},e.prototype.getOnShapeRemoved=function(){return this.onShapeRemoved},e.prototype.getOnSelectedShapeChanged=function(){return this.onSelectedShapeChanged},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.addShape=function(e){this.m_shapes.set(e.getId(),e),this.onShapeAdded.dispatch(e.getId())},e.prototype.getShapeById=function(e){return this.m_shapes.get(e)},e.prototype.selectShape=function(e){this.m_selectedShapeId=e,this.onSelectedShapeChanged.dispatch(e)},e.prototype.removeShape=function(e){this.m_shapes.delete(e),this.onShapeRemoved.dispatch(e)},e.prototype.getSelectedShapeId=function(){return this.m_selectedShapeId},e.prototype.getShapeIds=function(){return Array.from(this.m_shapes.keys())},e.prototype.getShapes=function(){return Array.from(this.m_shapes.values())},e.prototype.serialize=function(){return{width:this.m_width,height:this.m_height,shapes:this.getShapes().map((function(e){return e.serialize()}))}},e}();t.Canvas=i},372:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var o=n(59),i=function(){function e(e,t,n,i){this.onFrameChanged=new o.Event,this.m_canvas=i,this.m_frame=t,this.m_id=e,this.m_type=n}return e.prototype.getOnFrameChanged=function(){return this.onFrameChanged},e.prototype.getId=function(){return this.m_id},e.prototype.getFrame=function(){return this.m_frame},e.prototype.setFrame=function(e){this.m_frame=e,this.onFrameChanged.dispatch()},e.prototype.getType=function(){return this.m_type},e.prototype.getCanvas=function(){return this.m_canvas},e.prototype.serialize=function(){return{id:this.m_id,frame:this.m_frame,type:this.m_type}},e}();t.Shape=i},55:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeType=void 0,function(e){e[e.Rectangle=0]="Rectangle",e[e.Triangle=1]="Triangle",e[e.Ellipse=2]="Ellipse"}(n||(n={})),t.ShapeType=n},939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonView=void 0;var o=n(59),i=function(){function e(e,t){this.buttonHTML=document.createElement("button"),this.onClickSignal=new o.Event,this.m_text=e,this.buttonHTML.classList.add(t)}return e.prototype.getOnClickSignal=function(){return this.onClickSignal},e.prototype.render=function(e){var t=this;this.buttonHTML.innerHTML=this.m_text,this.buttonHTML.onclick=function(){return t.onClickSignal.dispatch()},e.appendChild(this.buttonHTML)},e}();t.ButtonView=i},875:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasView=void 0;var o=n(487),i=n(55),r=n(730),a=n(467),s=n(282),l=n(301),h=function(){function e(e){var t=this;this.m_shapeViews=new Map,this.m_canvasModel=e,this.m_controller=new o.CanvasController(e,this),this.m_element=document.createElement("div"),this.m_element.classList.add("canvas"),this.m_element.style.width="".concat(this.m_canvasModel.getWidth(),"px"),this.m_element.style.height="".concat(this.m_canvasModel.getHeight(),"px"),this.m_element.style.boxShadow="0 0 0 2px black",this.m_selectionView=new l.SelectionView(this.m_element,this.m_canvasModel),this.m_canvasModel.getShapeIds().forEach((function(e){return t.createShapeView(e)})),this.m_canvasModel.getOnShapeAdded().add((function(e){return t.createShapeView(e)})),this.m_canvasModel.getOnShapeRemoved().add((function(e){return t.removeShapeView(e)})),this.m_canvasModel.getOnSelectedShapeChanged().add((function(e){return t.selectShape(e)}))}return e.prototype.render=function(e){var t=this;this.m_element.addEventListener("mousedown",(function(e){e.defaultPrevented||t.m_controller.selectShape(null)})),e.appendChild(this.m_element),this.m_shapeViews.forEach((function(e){e.render(t.m_element)}))},e.prototype.remove=function(){this.m_element.remove()},e.prototype.selectShape=function(e){if(null!==e){var t=this.m_canvasModel.getShapeById(e);t&&this.m_selectionView.selectShape(t)}else this.m_selectionView.removeSelection()},e.prototype.removeShapeView=function(e){var t=this.m_shapeViews.get(e);t&&t.remove(),this.m_shapeViews.delete(e)},e.prototype.createShapeView=function(e){var t=this,n=this.m_canvasModel.getShapeById(e);if(n){var o;switch(n.getType()){case i.ShapeType.Ellipse:o=new r.EllipseView(n,this.m_element);break;case i.ShapeType.Rectangle:o=new a.RectangleView(n,this.m_element);break;case i.ShapeType.Triangle:o=new s.TriangleView(n,this.m_element)}this.m_shapeViews.set(e,o),o.getShapeSelected().add((function(e){t.m_controller.selectShape(e)}))}},e}();t.CanvasView=h},749:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragAndDropHandler=void 0;var o=n(59),i=function(){function e(e,t,n,i){this.m_shapeSelected=new o.Event,this.m_mouseMovedCallback=function(){},this.m_mouseUpCallback=function(){},this.m_model=e,this.m_controller=n,this.m_parentElement=t,this.m_element=i}return e.prototype.handle=function(e){this.onShapeMouseDown(e)},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.prototype.onShapeMouseUp=function(){window.removeEventListener("mousemove",this.m_mouseMovedCallback),window.removeEventListener("mouseup",this.m_mouseUpCallback)},e.prototype.onShapeMove=function(e,t,n){this.m_controller.moveShape(e.x-t,e.y-n)},e.prototype.onShapeMouseDown=function(e){var t=this;if(!e.defaultPrevented){e.preventDefault();var n=this.m_parentElement.getBoundingClientRect(),o=this.m_element.getBoundingClientRect(),i=n.left+(e.x-o.left),r=n.top+(e.y-o.top);this.m_shapeSelected.dispatch(),this.m_mouseMovedCallback=function(e){return t.onShapeMove(e,i,r)},this.m_mouseUpCallback=function(){return t.onShapeMouseUp()},window.addEventListener("mousemove",this.m_mouseMovedCallback),window.addEventListener("mouseup",this.m_mouseUpCallback)}},e}();t.DragAndDropHandler=i},291:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;var o=n(372),i=n(409),r=n(55),a=n(875),s=n(658),l=n(837),h=function(){function e(){var e=this;this.m_element=document.getElementById("editor"),this.m_canvasModel=new s.Canvas(640,480),this.m_canvasView=new a.CanvasView(this.m_canvasModel),this.m_controller=new l.ToolbarController(this.m_canvasModel),this.m_toolbarView=new i.ToolbarView((function(){return e.createShape(r.ShapeType.Rectangle)}),(function(){return e.createShape(r.ShapeType.Triangle)}),(function(){return e.createShape(r.ShapeType.Ellipse)}),(function(){return e.deleteShape()}),(function(){return e.saveDocument()}),(function(){return e.uploadFile((function(t){return e.uploadDocument(t)}))})),window.addEventListener("keydown",(function(t){"Delete"===t.key&&e.deleteShape()})),this.render()}return e.prototype.render=function(){this.m_toolbarView.render(this.m_element),this.m_canvasView.render(this.m_element)},e.prototype.createShape=function(e){var t={left:(this.m_canvasModel.getWidth()-100)/2,top:(this.m_canvasModel.getHeight()-100)/2,width:100,height:100},n=window.btoa((new Date).getTime().toString()),i=new o.Shape(n,t,e,this.m_canvasModel);this.m_controller.addShape(i),this.render()},e.prototype.deleteShape=function(){var e=this.m_canvasModel.getSelectedShapeId();null!==e&&(this.m_controller.selectShape(null),this.m_controller.removeShape(e))},e.prototype.saveDocument=function(){e.saveFile(JSON.stringify(this.m_canvasModel.serialize()),"canvas.json")},e.prototype.uploadDocument=function(e){var t=this,n=e;this.m_canvasView.remove(),this.m_canvasModel=new s.Canvas(n.width,n.height),this.m_canvasView=new a.CanvasView(this.m_canvasModel),n.shapes.map((function(e){return new o.Shape(e.id,e.frame,e.type,t.m_canvasModel)})).forEach((function(e){t.m_canvasModel.addShape(e)})),this.m_canvasView.render(this.m_element)},e.saveFile=function(e,t){var n=document.createElement("a"),o=new Blob([e],{type:"text/plain"});n.href=URL.createObjectURL(o),n.download=t,n.click()},e.prototype.uploadFile=function(e){var t=document.createElement("input");t.setAttribute("type","file"),t.click(),t.addEventListener("change",(function(){var n=new FileReader,o=t.files&&t.files[0];o&&(n.onload=function(){if("string"==typeof n.result)try{e(JSON.parse(n.result))}catch(e){alert("Invalid json file")}},n.readAsText(o))}))},e}();t.Editor=h},730:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel().getFrame();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(e.width,"'\n            height='").concat(e.height,"'\n            viewPort='0 0 ").concat(e.width," ").concat(e.height,"'>\"\n            <ellipse rx='").concat(e.width/2,"' ry='").concat(e.height/2,"' cx='").concat(e.width/2,"' cy='").concat(e.height/2,'\' fill="pink" />\n        </svg>')},t}(n(340).ShapeView);t.EllipseView=r},467:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel().getFrame();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(e.width,"'\n            height='").concat(e.height,"'\n            viewPort='0 0 ").concat(e.width," ").concat(e.height,"'>\"\n            <polygon points='").concat(0,",").concat(0," ").concat(e.width,",").concat(0," ").concat(e.width,",").concat(e.height," ").concat(0,",").concat(e.height,"' fill='brown' />\n        </svg>")},t}(n(340).ShapeView);t.RectangleView=r},425:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandler=void 0;var n="leftTop",o="leftBottom",i="rightTop",r="rightBottom",a=function(){function e(e,t,n){this.m_onMouseMoveCallback=function(){},this.m_onMouseUpCallback=function(){},this.m_parentElement=e,this.m_element=t,this.m_controller=n}return e.prototype.handle=function(e){this.addResizeHandlers(this.m_element,e)},e.createResizeController=function(e,t){switch(e.style.width="7px",e.style.height="7px",e.style.position="absolute",e.style.background="blue",e.style.pointerEvents="all",t){case o:e.style.bottom="-5px",e.style.left="-5px";break;case n:e.style.top="-5px",e.style.left="-5px";break;case i:e.style.top="-5px",e.style.right="-5px";break;case r:e.style.bottom="-5px",e.style.right="-5px"}},e.prototype.addResizeHandlers=function(t,a){var s=document.createElement("div"),l=document.createElement("div"),h=document.createElement("div"),c=document.createElement("div");e.createResizeController(s,n),e.createResizeController(l,o),e.createResizeController(h,i),e.createResizeController(c,r),s.addEventListener("mousedown",this.buildOnMouseDownCallback(n)),l.addEventListener("mousedown",this.buildOnMouseDownCallback(o)),h.addEventListener("mousedown",this.buildOnMouseDownCallback(i)),c.addEventListener("mousedown",this.buildOnMouseDownCallback(r)),t.appendChild(s),t.appendChild(l),t.appendChild(h),t.appendChild(c)},e.prototype.onMouseUp=function(){window.removeEventListener("mousemove",this.m_onMouseMoveCallback),window.removeEventListener("mouseup",this.m_onMouseUpCallback)},e.prototype.onMouseMove=function(e,t){var a=this.m_parentElement.getBoundingClientRect(),s=this.m_element.getBoundingClientRect(),l=e.x-a.left,h=e.y-a.top,c=s.left-a.left,p=s.top-a.top;switch(t){case n:this.m_controller.resizeShape(l,h,c+s.width,p+s.height);break;case i:this.m_controller.resizeShape(c,h,l,p+s.height);break;case o:this.m_controller.resizeShape(l,p,c+s.width,h);break;case r:this.m_controller.resizeShape(c,p,l,h)}},e.prototype.buildOnMouseDownCallback=function(e){var t=this;return function(n){n.preventDefault(),t.m_onMouseMoveCallback=function(n){t.onMouseMove(n,e)},t.m_onMouseUpCallback=function(){t.onMouseUp()},window.addEventListener("mousemove",t.m_onMouseMoveCallback),window.addEventListener("mouseup",t.m_onMouseUpCallback)}},e}();t.ResizeHandler=a},301:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionView=void 0;var o=n(588),i=n(425),r=function(){function e(e,t){this.m_onFrameChangeUnsubscribe=null,this.m_element=document.createElement("div"),this.m_element.style.boxShadow="0 0 0 1px black",this.m_element.style.position="absolute",this.m_element.style.pointerEvents="none",this.m_parentElement=e,this.m_controller=new o.SelectionController(t),this.m_resizeHandler=new i.ResizeHandler(e,this.m_element,this.m_controller)}return e.prototype.removeSelection=function(){null!==this.m_onFrameChangeUnsubscribe&&(this.m_onFrameChangeUnsubscribe(),this.m_onFrameChangeUnsubscribe=null,this.m_parentElement.removeChild(this.m_element))},e.prototype.selectShape=function(e){var t=this;this.m_onFrameChangeUnsubscribe=e.getOnFrameChanged().add((function(){return t.resizeSelector(e)})),this.resizeSelector(e),this.m_parentElement.appendChild(this.m_element),this.m_resizeHandler.handle(e)},e.prototype.resizeSelector=function(e){var t=e.getFrame();this.m_element.style.left=t.left+"px",this.m_element.style.top=t.top+"px",this.m_element.style.width=t.width+"px",this.m_element.style.height=t.height+"px"},e}();t.SelectionView=r},340:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeView=void 0;var o=n(623),i=n(749),r=n(59),a=function(){function e(e,t){var n=this;this.m_element=document.createElement("div"),this.m_shapeSelected=new r.Event,this.m_shape=e,this.m_controller=new o.ShapeController(e),this.parentElement=t,this.m_dragAndDropHandler=new i.DragAndDropHandler(this.m_shape,this.parentElement,this.m_controller,this.m_element),this.m_shape.getOnFrameChanged().add((function(){return n.resize()})),this.m_dragAndDropHandler.getShapeSelected().add((function(){n.m_shapeSelected.dispatch(n.m_shape.getId())}))}return e.prototype.getModel=function(){return this.m_shape},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.prototype.remove=function(){this.m_element.remove()},e.prototype.resize=function(){var e=this.m_shape.getFrame();this.m_element.style.left="".concat(e.left,"px"),this.m_element.style.top="".concat(e.top,"px"),this.m_element.style.width="".concat(e.width,"px"),this.m_element.style.height="".concat(e.height,"px"),this.m_element.style.position="absolute",this.m_element.innerHTML=this.getShapeSVG()},e.prototype.render=function(e){var t=this;this.m_element.remove(),this.resize(),this.m_element.onmousedown=function(e){return t.m_dragAndDropHandler.handle(e)},e.appendChild(this.m_element)},e}();t.ShapeView=a},409:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarView=void 0;var o=n(939),i=function(){function e(e,t,n,i,r,a){this.m_toolbarHtml=document.createElement("div"),this.m_createRectangleButton=new o.ButtonView("Rectangle","button"),this.m_createRectangleButton.getOnClickSignal().add((function(){return e()})),this.m_createEllipseButton=new o.ButtonView("Ellipse","button"),this.m_createEllipseButton.getOnClickSignal().add((function(){return n()})),this.m_createTriangleButton=new o.ButtonView("Triangle","button"),this.m_createTriangleButton.getOnClickSignal().add((function(){return t()})),this.m_deleteButton=new o.ButtonView("Delete","button"),this.m_deleteButton.getOnClickSignal().add((function(){return i()})),this.m_saveDocumentButton=new o.ButtonView("Save","button"),this.m_saveDocumentButton.getOnClickSignal().add((function(){return r()})),this.m_uploadDocumentButton=new o.ButtonView("Upload","button"),this.m_uploadDocumentButton.getOnClickSignal().add((function(){return a()}))}return e.prototype.render=function(e){this.m_toolbarHtml.classList.add("toolbar"),e.appendChild(this.m_toolbarHtml),this.m_createRectangleButton.render(this.m_toolbarHtml),this.m_createEllipseButton.render(this.m_toolbarHtml),this.m_createTriangleButton.render(this.m_toolbarHtml),this.m_saveDocumentButton.render(this.m_toolbarHtml),this.m_deleteButton.render(this.m_toolbarHtml),this.m_uploadDocumentButton.render(this.m_toolbarHtml)},e}();t.ToolbarView=i},282:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TriangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel().getFrame();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='100%'\n            height='100%'\n            viewPort='0 0 ".concat(e.width," ").concat(e.height,"'>\"\n            <polygon points='").concat(0,",").concat(e.height," ").concat(e.width,",").concat(e.height," ").concat(e.width/2,",").concat(0,"' fill='light blue' />\n        </svg>")},t}(n(340).ShapeView);t.TriangleView=r}},n={};e=function e(o){var i=n[o];if(void 0!==i)return i.exports;var r=n[o]={exports:{}};return t[o].call(r.exports,r,r.exports,e),r.exports}(291),window.onload=function(){new e.Editor}})();