(()=>{"use strict";var e,t,n={241:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.addShape=function(e){this.m_model.addShape(e)},e.prototype.removeShape=function(e){this.m_model.removeShape(e)},e}();t.EditorController=n},623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.setFrame=function(e,t,n,o){this.m_model.setFrame(e,t,n,o)},e}();t.ShapeController=n},998:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Editor=void 0;var o=n(147),i=function(){function e(e,t){this.onShapesChanged=new o.Signal,this.m_shapes=new Map,this.m_width=e,this.m_height=t}return e.prototype.getOnShapesChanged=function(){return this.onShapesChanged},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.addShape=function(e){this.m_shapes.set(e.getId(),e),this.onShapesChanged.dispatch(e.getId())},e.prototype.getShapeById=function(e){return this.m_shapes.get(e)},e.prototype.removeShape=function(e){this.m_shapes.delete(e),this.onShapesChanged.dispatch(e)},e}();t.Editor=i},372:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var o=n(147),i=function(){function e(e,t,n,i,r,s){this.onFrameChanged=new o.Signal,this.m_width=r,this.m_height=s,this.m_left=n,this.m_top=i,this.m_id=e,this.m_type=t}return e.prototype.getOnFrameChanged=function(){return this.onFrameChanged},e.prototype.getId=function(){return this.m_id},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.setFrame=function(e,t,n,o){this.m_left=e,this.m_top=t,this.m_width=n,this.m_height=o,this.onFrameChanged.dispatch()},e.prototype.getLeft=function(){return this.m_left},e.prototype.getTop=function(){return this.m_top},e.prototype.getType=function(){return this.m_type},e}();t.Shape=i},55:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeType=void 0,function(e){e[e.Rectangle=0]="Rectangle",e[e.Triangle=1]="Triangle",e[e.Ellipse=2]="Ellipse"}(n||(n={})),t.ShapeType=n},147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=t.ISignal=void 0;t.ISignal=function(){};var n=function(){function e(){this.m_listeners=[]}return e.prototype.add=function(e){var t=this;return this.m_listeners.push(e),function(){var n=t.m_listeners.indexOf(e);n>=0&&t.m_listeners.splice(n,1)}},e.prototype.addCallOnce=function(e){var t=this.add((function(n){e(n),t()}))},e.prototype.dispatch=function(e){for(var t=0,n=this.m_listeners;t<n.length;t++)(0,n[t])(e)},e}();t.Signal=n},939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonView=void 0;var o=n(147),i=function(){function e(e,t){this.buttonHTML=document.createElement("button"),this.onClickSignal=new o.Signal,this.m_text=e,this.buttonHTML.classList.add(t)}return e.prototype.getOnClickSignal=function(){return this.onClickSignal},e.prototype.render=function(e){var t=this;this.buttonHTML.innerHTML=this.m_text,this.buttonHTML.onclick=function(){return t.onClickSignal.dispatch()},e.appendChild(this.buttonHTML)},e}();t.ButtonView=i},749:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragAndDropHandler=void 0;var o=n(147),i=function(){function e(e,t,n,i){this.m_shapeSelected=new o.Signal,this.m_model=e,this.m_controller=n,this.m_canvas=t,this.m_element=i}return e.prototype.handle=function(e){this.onShapeMouseDown(e)},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.onShapeMouseUp=function(){window.onmousemove=null,window.onmouseup=null},e.prototype.onShapeMove=function(e,t,n){this.m_controller.setFrame(e.x-t,e.y-n,this.m_model.getWidth(),this.m_model.getHeight())},e.prototype.onShapeMouseDown=function(t){var n=this;if(!t.defaultPrevented){t.preventDefault();var o=this.m_canvas.getBoundingClientRect(),i=this.m_element.getBoundingClientRect(),r=o.left+(t.x-i.left),s=o.top+(t.y-i.top);this.m_shapeSelected.dispatch(),window.onmousemove=function(e){return n.onShapeMove(e,r,s)},window.onmouseup=function(){return e.onShapeMouseUp()}}},e}();t.DragAndDropHandler=i},541:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorView=void 0;var o=n(241),i=n(372),r=n(467),s=n(409),a=n(282),l=n(730),h=n(55),c=100,p=100,d=function(){function e(e,t){var n=this;this.m_shapeViews=new Map,this.m_shapeIdCounter=0,this.m_selectedShapeId=null,this.m_model=e,this.m_controller=new o.EditorController(e,this),this.m_editor=t,this.m_canvas=document.createElement("div"),this.m_canvas.classList.add("canvas"),this.m_canvas.style.width="".concat(this.m_model.getWidth(),"px"),this.m_canvas.style.height="".concat(this.m_model.getHeight(),"px"),this.m_model.getOnShapesChanged().add((function(e){return n.onShapeChanged(e)})),this.m_toolbarView=new s.ToolbarView((function(){return n.createRectangle()}),(function(){return n.createTriangle()}),(function(){return n.createEllipse()}),(function(){return n.deleteShape()})),window.onkeydown=function(e){"Delete"===e.key&&n.deleteShape()}}return e.prototype.render=function(){var e=this;this.m_canvas.innerHTML="",this.m_canvas.onmousedown=function(t){if(!t.defaultPrevented){if(null!==e.m_selectedShapeId){var n=e.m_shapeViews.get(e.m_selectedShapeId);n&&n.setIsSelected(!1)}e.m_selectedShapeId=null,e.render()}},this.m_toolbarView.render(this.m_editor),this.m_editor.appendChild(this.m_canvas),this.m_shapeViews.forEach((function(e){e.render()}))},e.prototype.onShapeChanged=function(e){var t=this,n=this.m_model.getShapeById(e);if(n){var o;switch(n.getType()){case h.ShapeType.Ellipse:o=new l.EllipseView(n,this.m_canvas);break;case h.ShapeType.Rectangle:o=new r.RectangleView(n,this.m_canvas);break;case h.ShapeType.Triangle:o=new a.TriangleView(n,this.m_canvas)}this.m_shapeViews.set(e,o),o.getShapeSelected().add((function(e){if(null!==t.m_selectedShapeId){var n=t.m_shapeViews.get(t.m_selectedShapeId);n&&n.setIsSelected(!1)}t.m_selectedShapeId=e,o.setIsSelected(!0),t.render()}))}else this.m_shapeViews.delete(e);this.render()},e.prototype.createRectangle=function(){var e=new i.Shape(this.m_shapeIdCounter++,h.ShapeType.Rectangle,(this.m_model.getWidth()-c)/2,(this.m_model.getHeight()-p)/2,c,p);this.m_controller.addShape(e),this.render()},e.prototype.createEllipse=function(){var e=new i.Shape(this.m_shapeIdCounter++,h.ShapeType.Ellipse,(this.m_model.getWidth()-c)/2,(this.m_model.getHeight()-p)/2,c,p);this.m_controller.addShape(e),this.render()},e.prototype.createTriangle=function(){var e=new i.Shape(this.m_shapeIdCounter++,h.ShapeType.Triangle,(this.m_model.getWidth()-c)/2,(this.m_model.getHeight()-p)/2,c,p);this.m_controller.addShape(e),this.render()},e.prototype.deleteShape=function(){null!==this.m_selectedShapeId&&this.m_controller.removeShape(this.m_selectedShapeId)},e}();t.EditorView=d},730:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <ellipse rx='").concat(t/2,"' ry='").concat(n/2,"' cx='").concat(t/2,"' cy='").concat(n/2,'\' fill="pink" />\n        </svg>')},t}(n(340).ShapeView);t.EllipseView=r},467:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(0," ").concat(t,",").concat(0," ").concat(t,",").concat(n," ").concat(0,",").concat(n,"' fill='brown' />\n        </svg>")},t}(n(340).ShapeView);t.RectangleView=r},425:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandler=void 0;var n=function(){function e(e,t,n,o){this.m_model=e,this.m_controller=n,this.m_canvas=t,this.m_element=o}return e.prototype.handle=function(){this.addResizeHandlers(this.m_element)},e.createResizeController=function(e,t){switch(e.style.width="5px",e.style.height="5px",e.style.position="absolute",e.style.background="blue",t){case"leftBottom":e.style.bottom="-5px",e.style.left="-5px";break;case"leftTop":e.style.top="-5px",e.style.left="-5px";break;case"rightBottom":e.style.bottom="-5px",e.style.right="-5px";break;case"rightTop":e.style.top="-5px",e.style.right="-5px"}},e.prototype.addResizeHandlers=function(t){var n=this,o=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div");e.createResizeController(o,"leftTop"),e.createResizeController(i,"rightTop"),e.createResizeController(r,"leftBottom"),e.createResizeController(s,"rightBottom"),i.onmousedown=function(t){t.preventDefault(),window.onmousemove=function(e){n.onMouseMove(e,"rightTop")},window.onmouseup=function(){e.onMouseUp()}},o.onmousedown=function(t){t.preventDefault(),window.onmousemove=function(e){n.onMouseMove(e,"leftTop")},window.onmouseup=function(){e.onMouseUp()}},s.onmousedown=function(t){t.preventDefault(),window.onmousemove=function(e){n.onMouseMove(e,"rightBottom")},window.onmouseup=function(){e.onMouseUp()}},r.onmousedown=function(t){t.preventDefault(),window.onmousemove=function(e){n.onMouseMove(e,"leftBottom")},window.onmouseup=function(){e.onMouseUp()}},t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(s)},e.onMouseUp=function(){window.onmousemove=null,window.onmouseup=null},e.prototype.onMouseMove=function(e,t){var n=this.m_canvas.getBoundingClientRect(),o=e.x-n.left,i=e.y-n.top;switch(t){case"leftTop":this.m_controller.setFrame(o,i,Math.max(this.m_model.getLeft()-o+this.m_model.getWidth(),0),Math.max(this.m_model.getTop()-i+this.m_model.getHeight(),0));break;case"rightTop":this.m_controller.setFrame(this.m_model.getLeft(),i,Math.max(o-this.m_model.getLeft(),0),Math.max(this.m_model.getTop()-i+this.m_model.getHeight(),0));break;case"leftBottom":this.m_controller.setFrame(o,this.m_model.getTop(),Math.max(this.m_model.getLeft()-o+this.m_model.getWidth(),0),Math.max(i-this.m_model.getTop(),0));break;case"rightBottom":this.m_controller.setFrame(this.m_model.getLeft(),this.m_model.getTop(),Math.max(o-this.m_model.getLeft(),0),Math.max(i-this.m_model.getTop(),0))}},e}();t.ResizeHandler=n},340:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeView=void 0;var o=n(623),i=n(749),r=n(425),s=n(147),a=function(){function e(e,t){var n=this;this.m_element=document.createElement("div"),this.m_shapeSelected=new s.Signal,this.m_isSelected=!1,this.m_model=e,this.m_controller=new o.ShapeController(e,this),this.m_canvas=t,this.m_dragAndDropHandler=new i.DragAndDropHandler(this.m_model,this.m_canvas,this.m_controller,this.m_element),this.m_resizeHandler=new r.ResizeHandler(this.m_model,this.m_canvas,this.m_controller,this.m_element),this.m_model.getOnFrameChanged().add((function(){return n.rerender()})),this.m_dragAndDropHandler.getShapeSelected().add((function(){n.m_shapeSelected.dispatch(n.m_model.getId())}))}return e.prototype.getModel=function(){return this.m_model},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.prototype.setIsSelected=function(e){this.m_isSelected=e,this.rerender()},e.prototype.rerender=function(){var e=this.m_model.getLeft(),t=this.m_model.getTop(),n=this.m_model.getWidth(),o=this.m_model.getHeight();this.m_element.style.left="".concat(e,"px"),this.m_element.style.top="".concat(t,"px"),this.m_element.style.width="".concat(n,"px"),this.m_element.style.height="".concat(o,"px"),this.m_element.style.position="absolute",this.m_element.style.boxShadow=this.m_isSelected?"0 0 0 1px black":"";var i=this.m_element.getElementsByTagName("svg")[0];i?i.outerHTML=this.getShapeHtmlImpl():this.m_element.innerHTML=this.getShapeHtmlImpl()},e.prototype.render=function(){var e=this;this.m_element.innerHTML="",this.m_element.remove(),this.rerender(),this.m_isSelected&&this.m_resizeHandler.handle(),this.m_element.onmousedown=function(t){return e.m_dragAndDropHandler.handle(t)},this.m_canvas.appendChild(this.m_element)},e}();t.ShapeView=a},409:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarView=void 0;var o=n(939),i=function(){function e(e,t,n,i){this.m_toolbarHtml=document.createElement("div"),this.m_createRectangleButton=new o.ButtonView("Rectangle","button"),this.m_createRectangleButton.getOnClickSignal().add((function(){return e()})),this.m_createEllipseButton=new o.ButtonView("Ellipse","button"),this.m_createEllipseButton.getOnClickSignal().add((function(){return n()})),this.m_createTriangleButton=new o.ButtonView("Triangle","button"),this.m_createTriangleButton.getOnClickSignal().add((function(){return t()})),this.m_createDeleteButton=new o.ButtonView("Delete","button"),this.m_createDeleteButton.getOnClickSignal().add((function(){return i()}))}return e.prototype.render=function(e){this.m_toolbarHtml.classList.add("toolbar"),e.appendChild(this.m_toolbarHtml),this.m_createRectangleButton.render(this.m_toolbarHtml),this.m_createEllipseButton.render(this.m_toolbarHtml),this.m_createTriangleButton.render(this.m_toolbarHtml),this.m_createDeleteButton.render(this.m_toolbarHtml)},e}();t.ToolbarView=i},282:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TriangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeHtmlImpl=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='100%'\n            height='100%'\n            viewPort='0 0 ".concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(n," ").concat(t,",").concat(n," ").concat(t/2,",").concat(0,"' fill='light blue' />\n        </svg>")},t}(n(340).ShapeView);t.TriangleView=r}},o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return n[e].call(r.exports,r,r.exports,i),r.exports}e=i(998),t=i(541),window.onload=function(){var n,o;n=new e.Editor(640,480),o=document.getElementById("editor"),new t.EditorView(n,o).render()}})();