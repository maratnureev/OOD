(()=>{"use strict";var e,t={487:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.addShape=function(e){this.m_model.addShape(e)},e.prototype.removeShape=function(e){this.m_model.removeShape(e)},e.prototype.selectShape=function(e){this.m_model.selectShape(e)},e}();t.CanvasController=n},623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeController=void 0;var n=function(){function e(e,t){this.m_model=e,this.m_view=t}return e.prototype.setFrame=function(e,t,n,o){this.m_model.setFrame(e,t,n,o)},e}();t.ShapeController=n},59:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Event=t.IEvent=void 0;t.IEvent=function(){};var n=function(){function e(){this.m_listeners=[]}return e.prototype.add=function(e){var t=this;return this.m_listeners.push(e),function(){var n=t.m_listeners.indexOf(e);n>=0&&t.m_listeners.splice(n,1)}},e.prototype.addCallOnce=function(e){var t=this.add((function(n){e(n),t()}))},e.prototype.dispatch=function(e){for(var t=0,n=this.m_listeners;t<n.length;t++)(0,n[t])(e)},e}();t.Event=n},658:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Canvas=void 0;var o=n(59),i=function(){function e(e,t,n,i){this.m_shapes=new Map,this.onSelectedShapeChanged=new o.Event,this.onShapesChanged=new o.Event,this.m_left=n,this.m_top=i,this.m_width=e,this.m_height=t,this.m_selectedShapeId=null}return e.prototype.getOnShapesChanged=function(){return this.onShapesChanged},e.prototype.getOnSelectedShapeChanged=function(){return this.onSelectedShapeChanged},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.getLeft=function(){return this.m_left},e.prototype.getTop=function(){return this.m_top},e.prototype.addShape=function(e){this.m_shapes.set(e.getId(),e),this.onShapesChanged.dispatch(e.getId())},e.prototype.getShapeById=function(e){return this.m_shapes.get(e)},e.prototype.selectShape=function(e){this.m_selectedShapeId=e,this.onSelectedShapeChanged.dispatch(e)},e.prototype.removeShape=function(e){this.m_shapes.delete(e),this.onShapesChanged.dispatch(e)},e.prototype.getSelectedShapeId=function(){return this.m_selectedShapeId},e}();t.Canvas=i},372:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var o=n(59),i=function(){function e(e,t,n,i,r,s,a){this.onFrameChanged=new o.Event,this.m_canvas=a,this.m_width=r,this.m_height=s,this.m_left=n,this.m_top=i,this.m_id=e,this.m_type=t}return e.prototype.getOnFrameChanged=function(){return this.onFrameChanged},e.prototype.getId=function(){return this.m_id},e.prototype.getWidth=function(){return this.m_width},e.prototype.getHeight=function(){return this.m_height},e.prototype.setFrame=function(e,t,n,o){var i=Math.min(Math.max(e+n,n),this.m_canvas.getWidth()),r=Math.min(Math.max(t+o,o),this.m_canvas.getHeight());e=Math.min(Math.max(e,0),this.m_canvas.getWidth()-this.m_width),t=Math.min(Math.max(t,0),this.m_canvas.getHeight()-this.m_height),this.m_left=Math.min(e,this.m_left+this.m_width),this.m_top=Math.min(t,this.m_top+this.m_height),this.m_width=Math.max(i-e,0),this.m_height=Math.max(r-t,0),this.onFrameChanged.dispatch()},e.prototype.getLeft=function(){return this.m_left},e.prototype.getTop=function(){return this.m_top},e.prototype.getType=function(){return this.m_type},e}();t.Shape=i},55:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeType=void 0,function(e){e[e.Rectangle=0]="Rectangle",e[e.Triangle=1]="Triangle",e[e.Ellipse=2]="Ellipse"}(n||(n={})),t.ShapeType=n},939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonView=void 0;var o=n(59),i=function(){function e(e,t){this.buttonHTML=document.createElement("button"),this.onClickSignal=new o.Event,this.m_text=e,this.buttonHTML.classList.add(t)}return e.prototype.getOnClickSignal=function(){return this.onClickSignal},e.prototype.render=function(e){var t=this;this.buttonHTML.innerHTML=this.m_text,this.buttonHTML.onclick=function(){return t.onClickSignal.dispatch()},e.appendChild(this.buttonHTML)},e}();t.ButtonView=i},875:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasView=void 0;var o=n(487),i=n(55),r=n(730),s=n(467),a=n(282),h=n(301),l=function(){function e(e){var t=this;this.m_shapeViews=new Map,this.m_model=e,this.m_controller=new o.CanvasController(e,this),this.m_selectionView=new h.SelectionView(this),this.m_canvas=document.createElement("div"),this.m_canvas.classList.add("canvas"),this.m_canvas.style.width="".concat(this.m_model.getWidth(),"px"),this.m_canvas.style.height="".concat(this.m_model.getHeight(),"px"),this.m_canvas.style.left="".concat(this.m_model.getLeft(),"px"),this.m_canvas.style.top="".concat(this.m_model.getTop(),"px"),this.m_model.getOnShapesChanged().add((function(e){return t.onShapeChanged(e)})),this.m_model.getOnSelectedShapeChanged().add((function(e){return t.selectShape(e)})),this.m_canvas.addEventListener("keydown",(function(e){"Delete"===e.key&&t.deleteShape()}))}return e.prototype.render=function(e){var t=this;this.m_canvas.addEventListener("mousedown",(function(e){e.defaultPrevented||t.m_controller.selectShape(null)})),e.appendChild(this.m_canvas),this.m_shapeViews.forEach((function(e){e.render(t.m_canvas)}))},e.prototype.addShape=function(e){this.m_controller.addShape(e)},e.prototype.deleteShape=function(){var e=this.m_model.getSelectedShapeId();null!==e&&(this.selectShape(null),this.m_controller.removeShape(e))},e.prototype.getCanvasBounders=function(){return this.m_canvas.getBoundingClientRect()},e.prototype.getDOMElement=function(){return this.m_canvas},e.prototype.selectShape=function(e){if(null!==e){var t=this.m_shapeViews.get(e);t&&this.m_selectionView.selectShape(t)}else this.m_selectionView.removeSelection()},e.prototype.onShapeChanged=function(e){var t=this,n=this.m_model.getShapeById(e),o=this.m_shapeViews.get(e);if(n){var h=void 0;switch(n.getType()){case i.ShapeType.Ellipse:h=new r.EllipseView(n,this);break;case i.ShapeType.Rectangle:h=new s.RectangleView(n,this);break;case i.ShapeType.Triangle:h=new a.TriangleView(n,this)}this.m_shapeViews.set(e,h),h.getShapeSelected().add((function(e){t.m_controller.selectShape(e)}))}else o&&o.remove(),this.m_shapeViews.delete(e)},e}();t.CanvasView=l},749:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DragAndDropHandler=void 0;var o=n(59),i=function(){function e(e,t,n,i){this.m_shapeSelected=new o.Event,this.m_mouseMovedCallback=function(){},this.m_mouseUpCallback=function(){},this.m_model=e,this.m_controller=n,this.m_canvas=t,this.m_element=i}return e.prototype.handle=function(e){this.onShapeMouseDown(e)},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.prototype.onShapeMouseUp=function(){window.removeEventListener("mousemove",this.m_mouseMovedCallback),window.removeEventListener("mouseup",this.m_mouseUpCallback)},e.prototype.onShapeMove=function(e,t,n){this.m_controller.setFrame(e.x-t,e.y-n,this.m_model.getWidth(),this.m_model.getHeight())},e.prototype.onShapeMouseDown=function(e){var t=this;if(!e.defaultPrevented){e.preventDefault();var n=this.m_canvas.getCanvasBounders(),o=this.m_element.getBoundingClientRect(),i=n.left+(e.x-o.left),r=n.top+(e.y-o.top);this.m_shapeSelected.dispatch(),this.m_mouseMovedCallback=function(e){return t.onShapeMove(e,i,r)},this.m_mouseUpCallback=function(){return t.onShapeMouseUp()},window.addEventListener("mousemove",this.m_mouseMovedCallback),window.addEventListener("mouseup",this.m_mouseUpCallback)}},e}();t.DragAndDropHandler=i},541:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EditorView=void 0;var o=n(372),i=n(409),r=n(55),s=n(875),a=n(658),h=function(){function e(){var e=this;this.m_shapeIdCounter=0,this.m_editor=document.getElementById("editor");var t=this.m_editor.getBoundingClientRect(),n=t.width/2,o=t.height/2;this.m_canvasModel=new a.Canvas(640,480,n,o),this.m_canvasView=new s.CanvasView(this.m_canvasModel),this.m_toolbarView=new i.ToolbarView((function(){return e.createShape(r.ShapeType.Rectangle)}),(function(){return e.createShape(r.ShapeType.Triangle)}),(function(){return e.createShape(r.ShapeType.Ellipse)}),(function(){return e.deleteShape()}))}return e.prototype.render=function(){this.m_toolbarView.render(this.m_editor),this.m_canvasView.render(this.m_editor)},e.prototype.createShape=function(e){var t=new o.Shape(this.m_shapeIdCounter++,e,(this.m_canvasModel.getWidth()-100)/2,(this.m_canvasModel.getHeight()-100)/2,100,100,this.m_canvasModel);this.m_canvasView.addShape(t),this.render()},e.prototype.deleteShape=function(){this.m_canvasView.deleteShape()},e}();t.EditorView=h},730:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EllipseView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <ellipse rx='").concat(t/2,"' ry='").concat(n/2,"' cx='").concat(t/2,"' cy='").concat(n/2,'\' fill="pink" />\n        </svg>')},t}(n(340).ShapeView);t.EllipseView=r},467:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='".concat(t,"'\n            height='").concat(n,"'\n            viewPort='0 0 ").concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(0," ").concat(t,",").concat(0," ").concat(t,",").concat(n," ").concat(0,",").concat(n,"' fill='brown' />\n        </svg>")},t}(n(340).ShapeView);t.RectangleView=r},425:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandler=void 0;var n=function(){function e(e,t){this.m_onMouseMoveCallback=function(){},this.m_onMouseUpCallback=function(){},this.m_canvas=e,this.m_element=t}return e.prototype.handle=function(e){this.addResizeHandlers(this.m_element,e)},e.createResizeController=function(e,t){switch(e.style.width="7px",e.style.height="7px",e.style.position="absolute",e.style.background="blue",e.style.pointerEvents="all",t){case"leftBottom":e.style.bottom="-5px",e.style.left="-5px";break;case"leftTop":e.style.top="-5px",e.style.left="-5px";break;case"rightBottom":e.style.bottom="-5px",e.style.right="-5px";break;case"rightTop":e.style.top="-5px",e.style.right="-5px"}},e.prototype.addResizeHandlers=function(t,n){var o=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div");e.createResizeController(o,"leftTop"),e.createResizeController(i,"leftBottom"),e.createResizeController(r,"rightTop"),e.createResizeController(s,"rightBottom"),o.addEventListener("mousedown",this.buildOnMouseDownCallback("leftTop",n)),i.addEventListener("mousedown",this.buildOnMouseDownCallback("leftBottom",n)),r.addEventListener("mousedown",this.buildOnMouseDownCallback("rightTop",n)),s.addEventListener("mousedown",this.buildOnMouseDownCallback("rightBottom",n)),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(s)},e.prototype.onMouseUp=function(){window.removeEventListener("mousemove",this.m_onMouseMoveCallback),window.removeEventListener("mouseup",this.m_onMouseUpCallback)},e.prototype.onMouseMove=function(e,t,n){var o=this.m_canvas.getCanvasBounders(),i=n.getModel(),r=e.x-o.left,s=e.y-o.top;switch(t){case"leftTop":n.setFrame(r,s,i.getLeft()-r+i.getWidth(),i.getTop()-s+i.getHeight());break;case"rightTop":n.setFrame(i.getLeft(),s,r-i.getLeft(),i.getTop()-s+i.getHeight());break;case"leftBottom":n.setFrame(r,i.getTop(),i.getLeft()-r+i.getWidth(),s-i.getTop());break;case"rightBottom":n.setFrame(i.getLeft(),i.getTop(),r-i.getLeft(),s-i.getTop())}},e.prototype.buildOnMouseDownCallback=function(e,t){var n=this;return function(o){o.preventDefault(),n.m_onMouseMoveCallback=function(o){n.onMouseMove(o,e,t)},n.m_onMouseUpCallback=function(){n.onMouseUp()},window.addEventListener("mousemove",n.m_onMouseMoveCallback),window.addEventListener("mouseup",n.m_onMouseUpCallback)}},e}();t.ResizeHandler=n},301:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionView=void 0;var o=n(425),i=function(){function e(e){this.m_onFrameChangeUnsubscribe=null,this.m_element=document.createElement("div"),this.m_element.style.boxShadow="0 0 0 1px black",this.m_element.style.position="absolute",this.m_element.style.pointerEvents="none",this.m_canvas=e,this.m_resizeHandler=new o.ResizeHandler(e,this.m_element)}return e.prototype.removeSelection=function(){null!==this.m_onFrameChangeUnsubscribe&&(this.m_onFrameChangeUnsubscribe(),this.m_onFrameChangeUnsubscribe=null,this.m_canvas.getDOMElement().removeChild(this.m_element))},e.prototype.selectShape=function(e){var t=this,n=e.getModel();this.m_onFrameChangeUnsubscribe=n.getOnFrameChanged().add((function(){return t.resizeSelector(n)})),this.resizeSelector(n),this.m_canvas.getDOMElement().appendChild(this.m_element),this.m_resizeHandler.handle(e)},e.prototype.resizeSelector=function(e){this.m_element.style.left=e.getLeft()+"px",this.m_element.style.top=e.getTop()+"px",this.m_element.style.width=e.getWidth()+"px",this.m_element.style.height=e.getHeight()+"px"},e}();t.SelectionView=i},340:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVG_NAMESPACE=t.ShapeView=void 0;var o=n(623),i=n(749),r=n(59);t.SVG_NAMESPACE="http://www.w3.org/2000/svg";var s=function(){function e(e,t){var n=this;this.m_element=document.createElement("div"),this.m_shapeSelected=new r.Event,this.m_model=e,this.m_controller=new o.ShapeController(e,this),this.m_canvas=t,this.m_dragAndDropHandler=new i.DragAndDropHandler(this.m_model,this.m_canvas,this.m_controller,this.m_element),this.m_model.getOnFrameChanged().add((function(){return n.resize()})),this.m_dragAndDropHandler.getShapeSelected().add((function(){n.m_shapeSelected.dispatch(n.m_model.getId())}))}return e.prototype.getModel=function(){return this.m_model},e.prototype.getShapeSelected=function(){return this.m_shapeSelected},e.prototype.getDOMElement=function(){return this.m_element},e.prototype.remove=function(){this.m_element.remove()},e.prototype.resize=function(){var e=this.m_model.getLeft(),t=this.m_model.getTop(),n=this.m_model.getWidth(),o=this.m_model.getHeight();this.m_element.style.left="".concat(e,"px"),this.m_element.style.top="".concat(t,"px"),this.m_element.style.width="".concat(n,"px"),this.m_element.style.height="".concat(o,"px"),this.m_element.style.position="absolute",this.m_element.innerHTML=this.getShapeSVG()},e.prototype.render=function(e){var t=this;this.m_element.remove(),this.resize(),this.m_element.onmousedown=function(e){return t.m_dragAndDropHandler.handle(e)},e.appendChild(this.m_element)},e.prototype.setFrame=function(e,t,n,o){this.m_controller.setFrame(e,t,n,o)},e}();t.ShapeView=s},409:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToolbarView=void 0;var o=n(939),i=function(){function e(e,t,n,i){this.m_toolbarHtml=document.createElement("div"),this.m_createRectangleButton=new o.ButtonView("Rectangle","button"),this.m_createRectangleButton.getOnClickSignal().add((function(){return e()})),this.m_createEllipseButton=new o.ButtonView("Ellipse","button"),this.m_createEllipseButton.getOnClickSignal().add((function(){return n()})),this.m_createTriangleButton=new o.ButtonView("Triangle","button"),this.m_createTriangleButton.getOnClickSignal().add((function(){return t()})),this.m_createDeleteButton=new o.ButtonView("Delete","button"),this.m_createDeleteButton.getOnClickSignal().add((function(){return i()}))}return e.prototype.render=function(e){this.m_toolbarHtml.classList.add("toolbar"),e.appendChild(this.m_toolbarHtml),this.m_createRectangleButton.render(this.m_toolbarHtml),this.m_createEllipseButton.render(this.m_toolbarHtml),this.m_createTriangleButton.render(this.m_toolbarHtml),this.m_createDeleteButton.render(this.m_toolbarHtml)},e}();t.ToolbarView=i},282:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TriangleView=void 0;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getShapeSVG=function(){var e=this.getModel(),t=e.getWidth(),n=e.getHeight();return"<svg\n            xmlns='http://www.w3.org/2000/svg'\n            width='100%'\n            height='100%'\n            viewPort='0 0 ".concat(t," ").concat(n,"'>\"\n            <polygon points='").concat(0,",").concat(n," ").concat(t,",").concat(n," ").concat(t/2,",").concat(0,"' fill='light blue' />\n        </svg>")},t}(n(340).ShapeView);t.TriangleView=r}},n={};e=function e(o){var i=n[o];if(void 0!==i)return i.exports;var r=n[o]={exports:{}};return t[o].call(r.exports,r,r.exports,e),r.exports}(541),window.onload=function(){(new e.EditorView).render()}})();